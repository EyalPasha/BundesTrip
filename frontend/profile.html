<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep your existing head content -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://bundestrip-652739569348.me-west1.run.app https://*.supabase.co; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://code.jquery.com https://unpkg.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data:;">
    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account - BundesTrip</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Load the same CSS files as index.html -->
    <link rel="stylesheet" href="styles/profile.css">
    <link rel="stylesheet" href="styles/trip-cards.css">
    <link rel="stylesheet" href="styles/mobile.css">
    <link rel="stylesheet" href="styles/footer.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <!-- Keep your existing navbar content -->
        <div class="container">
            <a class="navbar-brand" href="./index.html">
                <img src="./logos/blank_logo.png" alt="BundesTrip Logo" height="30" class="d-inline-block align-middle me-2">
                BundesTrip
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="./index.html">Trip Planner</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./schedules.html">Schedules</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./about.html">About Us</a>
                    </li>
                </ul>
                <!-- Authentication Menu -->
                <ul class="navbar-nav">
                    <!-- When not logged in -->
                    <li class="nav-item" id="loginMenuItem">
                        <a class="nav-link" href="./login.html">
                            <i class="fas fa-sign-in-alt me-1"></i>Login
                        </a>
                    </li>
                    <li class="nav-item" id="registerMenuItem">
                        <a class="nav-link" href="./register.html">
                            <i class="fas fa-user-plus me-1"></i>Register
                        </a>
                    </li>
                    <!-- When logged in -->
                    <li class="nav-item d-none" id="myAccountMenuItem">
                        <a class="nav-link" href="./profile.html">
                            <i class="fas fa-user me-1"></i>My Account
                        </a>
                    </li>
                    <li class="nav-item d-none" id="logoutMenuItem">
                        <a class="nav-link" href="#" onclick="logoutUser()">
                            <i class="fas fa-sign-out-alt me-1"></i>Log Out
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT WRAPPER -->
    <main class="flex-grow-1">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="container text-center">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <h1 id="profileName"></h1>
                <p id="profileEmail"></p>
            </div>
        </div>

        <!-- Dashboard Tabs -->
        <div class="container dashboard-tabs">
            <div class="card">
                <div class="card-body p-0">
                    <ul class="nav nav-pills nav-fill p-3" id="dashboardTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="trips-tab" data-bs-toggle="pill" data-bs-target="#trips" type="button" role="tab" aria-controls="trips" aria-selected="true">
                                <i class="fas fa-map-marked-alt me-2"></i>My Trips
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="settings-tab" data-bs-toggle="pill" data-bs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="false">
                                <i class="fas fa-cog me-2"></i>Settings
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="container my-4">
            <div class="tab-content" id="dashboardTabsContent">
                <!-- Keep all your existing tab content here -->
                <!-- My Trips Tab -->
                <div class="tab-pane fade show active" id="trips" role="tabpanel">
                    <!-- Keep all your existing trips content -->
                    <!-- Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card stats-card">
                                <div class="stats-number" id="totalTripsCount">â€”</div>
                                <div>Total Trips</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card stats-card">
                                <div class="stats-number" id="favoriteTripsCount">â€”</div>
                                <div>Favorites</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card stats-card">
                                <div class="stats-number" id="memberSinceCount">â€”</div>
                                <div>Days as Member</div>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Controls -->                                
                    <div class="filter-controls">
    <div class="row g-3">
        <div class="col-md-4">
            <div class="filter-section-title">
                <i class="fas fa-search"></i>
                Search Trips
            </div>
            <div class="input-group">
                <input type="text" 
                       class="form-control custom-search-input" 
                       id="tripSearchInput" 
                       placeholder="Search by destination, teams...">
            </div>
        </div>
        <div class="col-md-4">
            <div class="filter-section-title">
                <i class="fas fa-filter"></i>
                Filter By
            </div>
            <div class="custom-dropdown-container">
                <button class="custom-dropdown-button" id="tripFilterButton" type="button">
                    <span>All Trips</span>
                </button>
                <div class="custom-dropdown-menu" id="tripFilterMenu">
                    <div class="custom-dropdown-option selected" data-value="all">All Trips</div>
                    <div class="custom-dropdown-option" data-value="favorites">Favorites Only</div>
                    <div class="custom-dropdown-option" data-value="recent">Recent Trips</div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="filter-section-title">
                <i class="fas fa-sort"></i>
                Sort By
            </div>
            <div class="custom-dropdown-container">
                <button class="custom-dropdown-button" id="tripSortButton" type="button">
                    <span>Newest First</span>
                </button>
                <div class="custom-dropdown-menu" id="tripSortMenu">
                    <div class="custom-dropdown-option selected" data-value="newest">Newest First</div>
                    <div class="custom-dropdown-option" data-value="oldest">Oldest First</div>
                    <div class="custom-dropdown-option" data-value="alphabetical">A-Z</div>
                    <div class="custom-dropdown-option" data-value="favorites">Favorites First</div>
                    <div class="custom-dropdown-option" data-value="matches">Most Matches</div>
                </div>
            </div>
        </div>
    </div>
</div>

                    <!-- Trips Container - EXACT SAME STRUCTURE AS SEARCH RESULTS -->
                    <div id="tripsContainer">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane fade" id="settings" role="tabpanel">
                    <!-- Keep all your existing settings content -->
                    <div class="profile-settings-container">
                        <!-- Profile Form -->
                        <div class="profile-form-section">
                            <div class="profile-form-header">
                                <h5>
                                    <i class="fas fa-user-edit me-2"></i>
                                    Profile Settings
                                </h5>
                                <p>Manage your account information and preferences</p>
                            </div>
                            <div class="profile-form-body">
                                <form id="profileForm">
                                    <div class="form-group-enhanced">
                                        <label for="fullName" class="form-label-enhanced">
                                            <i class="fas fa-user"></i>
                                            Full Name
                                        </label>
                                        <input type="text" class="form-control-enhanced" id="fullName" 
                                               placeholder="Enter your full name">
                                        <div class="form-help-text">
                                            <i class="fas fa-info-circle"></i>
                                            This name will be displayed in your profile
                                        </div>
                                    </div>
                
                                    <div class="form-group-enhanced">
                                        <label for="email" class="form-label-enhanced">
                                            <i class="fas fa-envelope"></i>
                                            Email Address
                                        </label>
                                        <div class="readonly-input-container">
                                            <input type="email" class="form-control-enhanced form-control-readonly" 
                                                   id="email" readonly>
                                            <span class="readonly-indicator">
                                                <i class="fas fa-lock"></i>
                                            </span>
                                        </div>
                                        <div class="form-help-text">
                                            <i class="fas fa-shield-alt"></i>
                                            Email cannot be changed for security reasons
                                        </div>
                                    </div>
                
                                    <div class="form-group-enhanced">
                                        <label for="joinDate" class="form-label-enhanced">
                                            <i class="fas fa-calendar-plus"></i>
                                            Member Since
                                        </label>
                                        <div class="readonly-input-container">
                                            <input type="text" class="form-control-enhanced form-control-readonly" 
                                                   id="joinDate" readonly>
                                            <span class="readonly-indicator">
                                                <i class="fas fa-lock"></i>
                                            </span>
                                        </div>
                                        <div class="form-help-text">
                                            <i class="fas fa-clock"></i>
                                            Your account creation date
                                        </div>
                                    </div>
                
                                    <div class="text-center">
                                        <button type="submit" class="profile-update-btn">
                                            <i class="fas fa-save me-2"></i>
                                            Update Profile
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal (outside of main) -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modern-modal">
                <div class="modal-header modern-header">
                    <div class="header-content">
                        <div class="header-icon">
                            <i class="fas fa-trash-alt"></i>
                        </div>
                        <div class="header-text">
                            <h4 class="modal-title" id="deleteConfirmModalLabel">Remove Saved Trip</h4>
                            <p class="modal-subtitle">This action cannot be undone</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close-modern" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-footer modern-footer">
                    <button type="button" class="btn-modern btn-cancel" data-bs-dismiss="modal">
                        <div class="btn-content">
                            <i class="fas fa-arrow-left"></i>
                            <span>Keep Trip</span>
                        </div>
                    </button>
                    <button type="button" class="btn-modern btn-danger" id="confirmDeleteBtn">
                        <div class="btn-content">
                            <i class="fas fa-trash-alt"></i>
                            <span>Remove Trip</span>
                        </div>
                        <div class="btn-glow"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

<footer class="bg-dark text-light py-4 mt-auto">
    <div class="container">
        <div class="row">
            <!-- Company Info + Social Links -->
            <div class="col-md-6">
                <div class="company-info">
                    <h3>BundesTrip</h3>
                    <p>
                        Your ultimate companion for planning football trips across Germany. Discover the best matches, plan your journey, and create unforgettable memories.
                    </p>
                    <div class="social-links mt-3">
                        <a href="https://www.linkedin.com/in/eyalpasha/" class="text-light me-3" target="_blank" rel="noopener" title="LinkedIn">
                            <i class="fab fa-linkedin"></i>
                            <span class="visually-hidden">LinkedIn</span>
                        </a>
                        <a href="https://www.facebook.com/eyal.pasha" class="text-light me-3" target="_blank" rel="noopener" title="Facebook">
                            <i class="fab fa-facebook"></i>
                            <span class="visually-hidden">Facebook</span>
                        </a>
                        <a href="https://www.instagram.com/eyalpasha" class="text-light" target="_blank" rel="noopener" title="Instagram">
                            <i class="fab fa-instagram"></i>
                            <span class="visually-hidden">Instagram</span>
                        </a>
                    </div>
                </div>
            </div>
            <!-- Quick Links 1 -->
            <div class="col-md-3">
                <div class="footer-section">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="./index.html" class="text-light">Home</a></li>
                        <li><a href="./schedules.html" class="text-light">Schedules</a></li>
                        <li><a href="./about.html" class="text-light">About Us</a></li>
                    </ul>
                </div>
            </div>
            <!-- Quick Links 2 -->
            <div class="col-md-3">
                <div class="footer-section">
                    <h5>Account & Legal</h5>
                    <ul class="list-unstyled">
                        <li id="footer-account-link">
                            <a href="./login.html" class="text-light">Sign Up / Log In</a>
                        </li>
                        <li><a href="./privacy.html" class="text-light">Privacy Policy</a></li>
                        <li><a href="./terms.html" class="text-light">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="mt-3 text-center">
            <small>&copy; 2025 BundesTrip. All rights reserved.</small>
        </div>
    </div>
</footer>

    <!-- Scripts -->
    <!-- Keep all your existing scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="./services/supabase-config.js"></script>
    <script src="./services/supabase-auth.js"></script>
    <script src="./services/navigation.js"></script>
    <script src="./services/api-config.js"></script>
    <script src="./services/api.js" type="module"></script> 
    <script src="./services/trip-saver.js"></script>
    
    <!-- Include trip card and team logo functionality -->
    <script type="module">
        // Import all the necessary modules
        import { renderTripCard, renderTbdGames, initializeMatchesExpander } from './components/trip-card.js';
        import { getTeamLogoUrl, applyTeamLogoStyles } from './services/team-logos.js';
        
        // Make functions globally available
        window.renderTripCard = renderTripCard;
        window.renderTbdGames = renderTbdGames;
        window.getTeamLogoUrl = getTeamLogoUrl;
        
        let currentUser = null;
        let savedTrips = [];

        // Custom dropdown helper function
        function getCustomDropdownValue(dropdownType) {
            const menu = document.getElementById(`${dropdownType}Menu`);
            if (!menu) return null;
            
            const selectedOption = menu.querySelector('.custom-dropdown-option.selected');
            return selectedOption ? selectedOption.getAttribute('data-value') : null;
        }
    
        // Custom dropdown initialization function
        function initCustomDropdown(dropdownType, defaultValue) {
            const button = document.getElementById(`${dropdownType}Button`);
            const menu = document.getElementById(`${dropdownType}Menu`);
            
            if (!button || !menu) {
                console.warn(`Dropdown elements not found for ${dropdownType}`);
                return;
            }
            
            // Set default selection
            const defaultOption = menu.querySelector(`[data-value="${defaultValue}"]`);
            if (defaultOption) {
                // Remove previous selection
                menu.querySelectorAll('.custom-dropdown-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // Set new selection
                defaultOption.classList.add('selected');
                button.querySelector('span').textContent = defaultOption.textContent;
            }
            
            // Handle button click
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                
                // Close other dropdowns
                document.querySelectorAll('.custom-dropdown-menu.show').forEach(dropdown => {
                    if (dropdown !== menu) {
                        dropdown.classList.remove('show');
                        const otherButton = dropdown.previousElementSibling;
                        if (otherButton) otherButton.classList.remove('active');
                    }
                });
                
                // Toggle current dropdown
                menu.classList.toggle('show');
                button.classList.toggle('active');
            });
            
            // Handle option clicks
            menu.addEventListener('click', function(e) {
                if (e.target.classList.contains('custom-dropdown-option')) {
                    const value = e.target.getAttribute('data-value');
                    const text = e.target.textContent;
                    
                    // Update selection
                    menu.querySelectorAll('.custom-dropdown-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    e.target.classList.add('selected');
                    
                    // Update button text
                    button.querySelector('span').textContent = text;
                    
                    // Close dropdown
                    menu.classList.remove('show');
                    button.classList.remove('active');
                    
                    // Trigger change handler
                    if (dropdownType === 'tripFilter') {
                        handleFilterChange(value);
                    } else if (dropdownType === 'tripSort') {
                        handleSortChange(value);
                    }
                }
            });
        }
    
        // Filter function
        function filterTrips() {
            const searchTerm = document.getElementById('tripSearchInput').value.toLowerCase();
            const sortBy = getCustomDropdownValue('tripSort') || 'newest';
            const filterBy = getCustomDropdownValue('tripFilter') || 'all';
        
            let filteredTrips = [...savedTrips];
        
            // Apply enhanced search filter (using the logic from profileold.html)
            if (searchTerm) {
                filteredTrips = filteredTrips.filter(trip => {
                    // Search in trip name (with German character support)
                    if (normalizeGermanText(trip.trip_name).includes(normalizeGermanText(searchTerm))) {
                        return true;
                    }
                    
                    // Search in start location (with German character support)
                    const startLocation = trip.start_location || trip.trip_data?.start_location || trip.original_request?.start_location || '';
                    if (searchInLocation(searchTerm, startLocation)) {
                        return true;
                    }
                    
                    // Search in trip groups using the correct structure
                    const tripGroups = trip.trip_groups || [];
                    for (const group of tripGroups) {
                        // Check base_trip.Itinerary (main structure)
                        if (group.base_trip && group.base_trip.Itinerary) {
                            for (const day of group.base_trip.Itinerary) {
                                // Skip the summary day (usually last item)
                                if (day.hotel_stays || day.hotel_changes) continue;
                                
                                // Search in hotel locations (with German character support)
                                if (searchInLocation(searchTerm, day.location)) {
                                    return true;
                                }
                                
                                // Search in hotel names (with German character support)
                                if (day.hotel && (
                                    normalizeGermanText(day.hotel).includes(normalizeGermanText(searchTerm)) ||
                                    day.hotel.toLowerCase().includes(searchTerm.toLowerCase())
                                )) {
                                    return true;
                                }
                                
                                // Search in matches for team names
                                if (day.matches && day.matches.length > 0) {
                                    for (const match of day.matches) {
                                        // Extract team names from match string
                                        const matchText = match.match || '';
                                        const teams = extractTeamsFromMatchString(matchText);
                                        
                                        // Search in extracted team names (with German character support)
                                        if (teams.home && searchInTeamNames(searchTerm, teams.home)) {
                                            return true;
                                        }
                                        if (teams.away && searchInTeamNames(searchTerm, teams.away)) {
                                            return true;
                                        }
                                        
                                        // Search in venue/location (with German character support)
                                        if (searchInLocation(searchTerm, match.location)) {
                                            return true;
                                        }
                                        
                                        // Search in travel_from (with German character support)
                                        if (searchInLocation(searchTerm, match.travel_from)) {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Check variations array (alternative structure)
                        if (group.variations) {
                            for (const variation of group.variations) {
                                if (variation.Itinerary) {
                                    for (const day of variation.Itinerary) {
                                        // Search in hotel locations (with German character support)
                                        if (searchInLocation(searchTerm, day.hotel_location)) {
                                            return true;
                                        }
                                        
                                        // Search in hotel names (with German character support)
                                        if (day.hotel_name && (
                                            normalizeGermanText(day.hotel_name).includes(normalizeGermanText(searchTerm)) ||
                                            day.hotel_name.toLowerCase().includes(searchTerm.toLowerCase())
                                        )) {
                                            return true;
                                        }
                                        
                                        // Search in matches
                                        if (day.matches) {
                                            for (const match of day.matches) {
                                                if (searchInTeamNames(searchTerm, match.home_team) || 
                                                    searchInTeamNames(searchTerm, match.away_team)) {
                                                    return true;
                                                }
                                                
                                                if (searchInLocation(searchTerm, match.venue)) {
                                                    return true;
                                                }
                                                
                                                if (searchInLocation(searchTerm, match.location)) {
                                                    return true;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    
                    // Search in must_teams (preferred teams) with German character support
                    const mustTeams = trip.must_teams || trip.original_request?.must_teams || [];
                    for (const team of mustTeams) {
                        if (searchInTeamNames(searchTerm, team)) {
                            return true;
                        }
                    }
                    
                    // Search in preferred_leagues with German character support
                    const preferredLeagues = trip.preferred_leagues || trip.original_request?.preferred_leagues || [];
                    for (const league of preferredLeagues) {
                        if (normalizeGermanText(league).includes(normalizeGermanText(searchTerm)) ||
                            league.toLowerCase().includes(searchTerm.toLowerCase())) {
                            return true;
                        }
                    }
                    
                    // Search in TBD games with German character support
                    const tbdGames = trip.tbd_games || [];
                    for (const game of tbdGames) {
                        if (searchInTeamNames(searchTerm, game.home_team) || 
                            searchInTeamNames(searchTerm, game.away_team)) {
                            return true;
                        }
                        if (searchInLocation(searchTerm, game.venue)) {
                            return true;
                        }
                        if (searchInLocation(searchTerm, game.location)) {
                            return true;
                        }
                    }
                    
                    return false;
                });
            }
        
            // Apply category filter - FIXED LOGIC
            switch (filterBy) {
                case 'favorites':
                    filteredTrips = filteredTrips.filter(trip => trip.is_favorite);
                    break;
                case 'recent':
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    filteredTrips = filteredTrips.filter(trip => 
                        new Date(trip.created_at) >= thirtyDaysAgo
                    );
                    break;
                case 'all':
                default:
                    // No additional filtering
                    break;
            }
        
            // Apply sorting
            switch (sortBy) {
                case 'oldest':
                    filteredTrips.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
                    break;
                case 'alphabetical':
                    filteredTrips.sort((a, b) => a.trip_name.localeCompare(b.trip_name));
                    break;
                case 'favorites':
                    filteredTrips.sort((a, b) => {
                        if (a.is_favorite && !b.is_favorite) return -1;
                        if (!a.is_favorite && b.is_favorite) return 1;
                        return new Date(b.created_at) - new Date(a.created_at);
                    });
                    break;
                case 'matches':
                    filteredTrips.sort((a, b) => {
                        const getMatchCount = (trip) => {
                            let count = 0;
                            const tripGroups = trip.trip_groups || [];
                            tripGroups.forEach(group => {
                                if (group.base_trip && group.base_trip.Itinerary) {
                                    group.base_trip.Itinerary.forEach(day => {
                                        if (day.matches) count += day.matches.length;
                                    });
                                }
                                if (group.variations) {
                                    group.variations.forEach(variation => {
                                        if (variation.Itinerary) {
                                            variation.Itinerary.forEach(day => {
                                                if (day.matches) count += day.matches.length;
                                            });
                                        }
                                    });
                                }
                            });
                            return count;
                        };
                        return getMatchCount(b) - getMatchCount(a);
                    });
                    break;
                case 'newest':
                default:
                    filteredTrips.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    break;
            }
        
            displaySavedTrips(filteredTrips);
        }
        
        // Add this new helper function to check if trip has games from specific league:
        function tripHasLeague(trip, targetLeague) {
            // First check preferred_leagues (what user originally requested)
            const preferredLeagues = trip.preferred_leagues || trip.original_request?.preferred_leagues || [];
            if (preferredLeagues.includes(targetLeague)) {
                return true;
            }
            
            // Then check actual matches in the trip to see if any are from this league
            const tripGroups = trip.trip_groups || [];
            for (const group of tripGroups) {
                // Check base_trip.Itinerary
                if (group.base_trip && group.base_trip.Itinerary) {
                    for (const day of group.base_trip.Itinerary) {
                        if (day.matches && day.matches.length > 0) {
                            for (const match of day.matches) {
                                // Check if match has league information
                                if (match.league && match.league === targetLeague) {
                                    return true;
                                }
                                // Also check competition field
                                if (match.competition && match.competition === targetLeague) {
                                    return true;
                                }
                                // For matches without explicit league info, try to infer from team names
                                if (inferLeagueFromMatch(match, targetLeague)) {
                                    return true;
                                }
                            }
                        }
                    }
                }
                
                // Check variations array
                if (group.variations) {
                    for (const variation of group.variations) {
                        if (variation.Itinerary) {
                            for (const day of variation.Itinerary) {
                                if (day.matches) {
                                    for (const match of day.matches) {
                                        if (match.league && match.league === targetLeague) {
                                            return true;
                                        }
                                        if (match.competition && match.competition === targetLeague) {
                                            return true;
                                        }
                                        if (inferLeagueFromMatch(match, targetLeague)) {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            // Check TBD games
            const tbdGames = trip.tbd_games || [];
            for (const game of tbdGames) {
                if (game.league && game.league === targetLeague) {
                    return true;
                }
                if (game.competition && game.competition === targetLeague) {
                    return true;
                }
                if (inferLeagueFromMatch(game, targetLeague)) {
                    return true;
                }
            }
            
            return false;
        }
        
        // Helper function to infer league from team names
        function inferLeagueFromMatch(match, targetLeague) {
            const bundesligaTeams = [
                'Bayern MÃ¼nchen', 'Borussia Dortmund', 'RB Leipzig', 'FC Schalke 04',
                'Eintracht Frankfurt', 'Bayer Leverkusen', 'Borussia MÃ¶nchengladbach',
                'VfL Wolfsburg', 'SC Freiburg', 'TSG Hoffenheim', 'VfB Stuttgart',
                'FC Augsburg', '1. FC KÃ¶ln', '1. FSV Mainz 05', 'Hertha Berlin',
                'Werder Bremen', 'VfL Bochum', '1. FC Heidenheim'
            ];
            
            const bundesliga2Teams = [
                '1. FC Magdeburg', 'PreuÃŸen MÃ¼nster', 'Eintracht Braunschweig',
                '1. FC Kaiserslautern', 'Fortuna DÃ¼sseldorf', 'Hannover 96',
                '1. FC NÃ¼rnberg', 'Karlsruher SC', 'SC Paderborn 07'
            ];
            
            if (targetLeague === 'Bundesliga') {
                const homeTeam = match.home_team || extractTeamsFromMatchString(match.match || '').home || '';
                const awayTeam = match.away_team || extractTeamsFromMatchString(match.match || '').away || '';
                
                return bundesligaTeams.some(team => 
                    normalizeGermanText(homeTeam).includes(normalizeGermanText(team)) ||
                    normalizeGermanText(awayTeam).includes(normalizeGermanText(team)) ||
                    normalizeGermanText(team).includes(normalizeGermanText(homeTeam)) ||
                    normalizeGermanText(team).includes(normalizeGermanText(awayTeam))
                );
            }
            
            if (targetLeague === '2. Bundesliga') {
                const homeTeam = match.home_team || extractTeamsFromMatchString(match.match || '').home || '';
                const awayTeam = match.away_team || extractTeamsFromMatchString(match.match || '').away || '';
                
                return bundesliga2Teams.some(team => 
                    normalizeGermanText(homeTeam).includes(normalizeGermanText(team)) ||
                    normalizeGermanText(awayTeam).includes(normalizeGermanText(team)) ||
                    normalizeGermanText(team).includes(normalizeGermanText(homeTeam)) ||
                    normalizeGermanText(team).includes(normalizeGermanText(awayTeam))
                );
            }
            
            return false;
        }
        
        // Add all the helper functions from profileold.html:
        function normalizeGermanText(text) {
            if (!text) return '';
            
            return text
                .replace(/Ã¼/g, 'u')    // Ã¼ -> u
                .replace(/Ã¶/g, 'o')    // Ã¶ -> o  
                .replace(/Ã¤/g, 'a')    // Ã¤ -> a
                .replace(/ÃŸ/g, 'ss')   // ÃŸ -> ss
                .replace(/Ãœ/g, 'U')    // Ãœ -> U
                .replace(/Ã–/g, 'O')    // Ã– -> O
                .replace(/Ã„/g, 'A')    // Ã„ -> A
                .toLowerCase();
        }
        
        function searchInLocation(searchTerm, location) {
            if (!location) return false;
            
            const term = normalizeGermanText(searchTerm.toLowerCase());
            const loc = normalizeGermanText(location.toLowerCase());
            
            // Direct match with normalized text
            if (loc.includes(term)) {
                return true;
            }
            
            // Also check original text without normalization
            if (location.toLowerCase().includes(searchTerm.toLowerCase())) {
                return true;
            }
            
            // Common German city aliases
            const cityAliases = {
                'munich': ['mÃ¼nchen', 'munchen'],
                'munchen': ['mÃ¼nchen', 'munich'],
                'mÃ¼nchen': ['munich', 'munchen'],
                'cologne': ['kÃ¶ln', 'koln'],
                'koln': ['kÃ¶ln', 'cologne'],
                'kÃ¶ln': ['cologne', 'koln'],
                'nuremberg': ['nÃ¼rnberg', 'nurnberg'],
                'nurnberg': ['nÃ¼rnberg', 'nuremberg'],
                'nÃ¼rnberg': ['nuremberg', 'nurnberg'],
                'dusseldorf': ['dÃ¼sseldorf'],
                'dÃ¼sseldorf': ['dusseldorf']
            };
            
            // Check city aliases
            for (const [key, aliases] of Object.entries(cityAliases)) {
                const normalizedKey = normalizeGermanText(key);
                if (term.includes(normalizedKey) || normalizedKey.includes(term)) {
                    return aliases.some(alias => {
                        const normalizedAlias = normalizeGermanText(alias);
                        return normalizedAlias.includes(term) || loc.includes(normalizedAlias);
                    });
                }
            }
            
            return false;
        }
        
        function searchInTeamNames(searchTerm, teamName) {
            if (!teamName) return false;
            
            const term = normalizeGermanText(searchTerm.toLowerCase());
            const team = normalizeGermanText(teamName.toLowerCase());
            
            // Direct match with normalized text
            if (team.includes(term)) {
                return true;
            }
            
            // Also check original text without normalization
            if (teamName.toLowerCase().includes(searchTerm.toLowerCase())) {
                return true;
            }
            
            // Enhanced German team abbreviations and alternate names
            const teamAliases = {
                // Bundesliga teams
                'bayern': ['bayern munich', 'fc bayern', 'fcb', 'fc bayern mÃ¼nchen', 'fc bayern munchen'],
                'munich': ['bayern munich', 'fc bayern', 'bayern mÃ¼nchen', 'bayern munchen'],
                'munchen': ['bayern munich', 'fc bayern', 'bayern mÃ¼nchen', 'mÃ¼nchen'],
                'dortmund': ['borussia dortmund', 'bvb', 'bvb 09', 'borussia'],
                'leipzig': ['rb leipzig', 'red bull leipzig', 'rasenballsport'],
                'schalke': ['fc schalke 04', 's04', 'schalke 04'],
                'frankfurt': ['eintracht frankfurt', 'sge'],
                'leverkusen': ['bayer leverkusen', 'bayer 04', 'werkself'],
                'gladbach': ['borussia mÃ¶nchengladbach', 'borussia monchengladbach', 'bmg', 'borussia mg', 'mÃ¶nchengladbach', 'monchengladbach'],
                'wolfsburg': ['vfl wolfsburg', 'wob'],
                'berlin': ['hertha berlin', 'hertha bsc', 'union berlin', '1. fc union'],
                'hamburg': ['hamburger sv', 'hsv', 'hamburg sv'],
                'bremen': ['werder bremen', 'sv werder', 'werder'],
                'cologne': ['1. fc kÃ¶ln', '1. fc koln', 'fc kÃ¶ln', 'fc koln', 'kÃ¶ln', 'koln'],
                'koln': ['1. fc kÃ¶ln', 'fc kÃ¶ln', 'kÃ¶ln', 'cologne'],
                'stuttgart': ['vfb stuttgart', 'vfb'],
                'hoffenheim': ['tsg hoffenheim', 'tsg 1899', 'tsg'],
                'freiburg': ['sc freiburg', 'sport-club freiburg'],
                'mainz': ['1. fsv mainz 05', 'fsv mainz', 'mainz 05'],
                'augsburg': ['fc augsburg', 'fca'],
                'bochum': ['vfl bochum', 'vfl bochum 1848'],
                'heidenheim': ['1. fc heidenheim', 'fc heidenheim'],
                
                // 2. Bundesliga teams
                'magdeburg': ['1. fc magdeburg', 'fc magdeburg'],
                'munster': ['preuÃŸen mÃ¼nster', 'preussen mÃ¼nster', 'sc preuÃŸen mÃ¼nster', 'sc preussen munster', 'mÃ¼nster'],
                'mÃ¼nster': ['preuÃŸen mÃ¼nster', 'preussen mÃ¼nster', 'sc preuÃŸen mÃ¼nster', 'preussen munster'],
                'preussen': ['preuÃŸen mÃ¼nster', 'preussen mÃ¼nster', 'sc preuÃŸen mÃ¼nster'],
                'braunschweig': ['eintracht braunschweig'],
                'kaiserslautern': ['1. fc kaiserslautern', 'fck', 'fc kaiserslautern'],
                'dusseldorf': ['fortuna dÃ¼sseldorf', 'fortuna dusseldorf', 'f95', 'fortuna'],
                'dÃ¼sseldorf': ['fortuna dÃ¼sseldorf', 'fortuna dusseldorf', 'f95', 'fortuna'],
                'hannover': ['hannover 96', 'h96'],
                'nuremberg': ['1. fc nÃ¼rnberg', '1. fc nurnberg', 'fcn', 'nÃ¼rnberg', 'nurnberg'],
                'nurnberg': ['1. fc nÃ¼rnberg', 'fcn', 'nÃ¼rnberg', 'nuremberg'],
                'nÃ¼rnberg': ['1. fc nÃ¼rnberg', '1. fc nurnberg', 'fcn', 'nurnberg', 'nuremberg'],
                'karlsruhe': ['karlsruher sc', 'ksc'],
                'paderborn': ['sc paderborn 07', 'scp']
            };
            
            // Check if search term matches any alias (with normalization)
            for (const [key, aliases] of Object.entries(teamAliases)) {
                const normalizedKey = normalizeGermanText(key);
                if (term.includes(normalizedKey) || normalizedKey.includes(term)) {
                    return aliases.some(alias => {
                        const normalizedAlias = normalizeGermanText(alias);
                        return normalizedAlias.includes(term) || team.includes(normalizedAlias);
                    });
                }
            }
            
            return false;
        }
        
        function extractTeamsFromMatchString(matchString) {
            // Match string format: "1. FC Magdeburg vs PreuÃŸen MÃ¼nster (17:30)"
            if (!matchString) return { home: null, away: null };
            
            // Remove time in parentheses and extract teams
            const cleanMatch = matchString.replace(/\s*\([^)]*\)\s*$/, '');
            const vsPatterns = [' vs ', ' v ', ' - ', ' : '];
            
            for (const pattern of vsPatterns) {
                if (cleanMatch.includes(pattern)) {
                    const teams = cleanMatch.split(pattern);
                    if (teams.length === 2) {
                        return {
                            home: teams[0].trim(),
                            away: teams[1].trim()
                        };
                    }
                }
            }
            
            return { home: null, away: null };
        }
        // Change handlers
        function handleFilterChange(filterValue) {
            // console.log('Filter changed to:', filterValue);
            setTimeout(() => filterTrips(), 50);
        }
    
        function handleSortChange(sortValue) {
            // console.log('Sort changed to:', sortValue);
            setTimeout(() => filterTrips(), 50);
        }
    
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async () => {
            // console.log('ðŸš€ Initializing profile dashboard...');
            
            // Apply team logo styles
            applyTeamLogoStyles();
            
            // Initialize match expanders
            initializeMatchesExpander();
            
            // Wait for auth service
            await new Promise(resolve => {
                const checkAuth = () => {
                    if (window.authService && window.authService.initialized) {
                        resolve();
                    } else {
                        setTimeout(checkAuth, 100);
                    }
                };
                checkAuth();
            });
            
            currentUser = await window.authService.getCurrentUser();
            
            if (!currentUser) {
                window.location.href = './login.html';
                return;
            }
    
            // Initialize API service
            if (!window.apiService) {
                const { ApiService } = await import('./services/api.js');
                window.apiService = new ApiService();
            }
            
            // Populate profile data
            populateProfileData();
            
            // Load dashboard data
            await loadDashboardData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Update navigation
            if (window.updateNavigationState) {
                await updateNavigationState();
            }
    
            // Initialize custom dropdowns
            setTimeout(() => {
                initCustomDropdown('tripFilter', 'all');
                initCustomDropdown('tripSort', 'newest');
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', function(event) {
                    const dropdowns = document.querySelectorAll('.custom-dropdown-menu.show');
                    dropdowns.forEach(dropdown => {
                        const container = dropdown.closest('.custom-dropdown-container');
                        if (!container.contains(event.target)) {
                            dropdown.classList.remove('show');
                            const button = container.querySelector('.custom-dropdown-button');
                            if (button) button.classList.remove('active');
                        }
                    });
                });
            }, 500);
            
            // console.log('âœ… Profile dashboard initialized successfully');
        });
    
        function populateProfileData() {
            const fullName = currentUser.user_metadata?.full_name || '';
            const email = currentUser.email || '';
            const joinDate = new Date(currentUser.created_at).toLocaleDateString();
            
            document.getElementById('profileName').textContent = fullName || 'My Account';
            document.getElementById('profileEmail').textContent = email;
            document.getElementById('fullName').value = fullName;
            document.getElementById('email').value = email;
            document.getElementById('joinDate').value = joinDate;
    
            // Calculate days since joining
            const daysSinceJoin = Math.floor((new Date() - new Date(currentUser.created_at)) / (1000 * 60 * 60 * 24));
            document.getElementById('memberSinceCount').textContent = daysSinceJoin;
        }
    
        async function loadDashboardData() {
            try {
                // console.log('ðŸ“Š Loading dashboard data...');
                
                // Load saved trips
                await loadSavedTrips();
                
                // Update stats
                updateStatsCards();
                
            } catch (error) {
                console.error('âŒ Failed to load dashboard data:', error);
            }
        }
    
        async function loadSavedTrips() {
            try {
                // console.log('ðŸ—‚ï¸ Loading saved trips...');
                
                const response = await window.apiService.getSavedTrips(50, false);
                savedTrips = response.trips || [];
                
                // console.log(`âœ… Loaded ${savedTrips.length} saved trips`);
                displaySavedTrips(savedTrips);
                
            } catch (error) {
                console.error('âŒ Failed to load saved trips:', error);
                document.getElementById('tripsContainer').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h5>Failed to Load Trips</h5>
                        <p>There was an error loading your saved trips.</p>
                        <button class="btn btn-primary" onclick="location.reload()">Try Again</button>
                    </div>
                `;
            }
        }
    
        function displaySavedTrips(trips) {
            const container = document.getElementById('tripsContainer');
            
            if (!trips || trips.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-route"></i>
                        <h5>No Saved Trips Yet</h5>
                        <p>Start planning your next football adventure!</p>
                        <a href="./index.html" class="btn btn-primary">
                            Plan Your Next Trip
                        </a>
                    </div>
                `;
                return;
            }
    
            // Clear container and add results structure
            container.innerHTML = `
                <div id="tripResults" class="trip-results-container">
                    <!-- Trip cards will be rendered here -->
                </div>
            `;
    
            const tripResults = document.getElementById('tripResults');
            let tripIndex = 1;
    
            trips.forEach((savedTrip) => {
                // console.log('ðŸ” Processing saved trip:', savedTrip);
                
                // Extract data from the correct locations
                const tripGroups = savedTrip.trip_groups || [];
                const startLocation = savedTrip.start_location || savedTrip.original_request?.start_location || 'Unknown';
                const startDate = savedTrip.start_date || savedTrip.original_request?.start_date || 'Unknown';
                const tripDuration = savedTrip.trip_duration || savedTrip.original_request?.trip_duration || 3;
                const maxTravelTime = savedTrip.max_travel_time || savedTrip.original_request?.max_travel_time || 240;
                const preferredLeagues = savedTrip.preferred_leagues || savedTrip.original_request?.preferred_leagues || [];
                const mustTeams = savedTrip.must_teams || savedTrip.original_request?.must_teams || [];
                const minGames = savedTrip.min_games || savedTrip.original_request?.min_games || 2;
    
                if (tripGroups && tripGroups.length > 0) {
                    tripGroups.forEach((group, groupIndex) => {
                        // console.log(`ðŸŽ¯ Rendering trip group ${groupIndex + 1}:`, group);
                        
                        // Add saved trip management header
                        const savedTripHeader = document.createElement('div');
                        savedTripHeader.className = 'saved-trip-header';
                        savedTripHeader.innerHTML = `
                            <div class="trip-actions-header">
                                <button class="btn btn-sm btn-favorite ${savedTrip.is_favorite ? 'favorited' : ''}" 
                                        onclick="toggleTripFavorite('${savedTrip.id}', ${savedTrip.is_favorite})" 
                                        title="${savedTrip.is_favorite ? 'Remove from favorites' : 'Add to favorites'}">
                                    <i class="fas fa-heart"></i>
                                    ${savedTrip.is_favorite ? 'Favorited' : 'Favorite'}
                                </button>
                                <button class="btn btn-sm btn-delete" 
                                        onclick="showDeleteConfirm('${savedTrip.id}', '${savedTrip.trip_name}')" 
                                        title="Delete this trip">
                                    <i class="fas fa-trash"></i>
                                    Delete
                                </button>
                            </div>
                        `;
                        tripResults.appendChild(savedTripHeader);
                        
                        // Create trip context exactly like search results
                        const tripContext = {
                            tripDuration: tripDuration,
                            maxTravelTime: maxTravelTime,
                            preferredLeagues: preferredLeagues,
                            mustTeams: mustTeams,
                            minGames: minGames
                        };
                        
                        // Use the renderTripCard function
                        try {
                            renderTripCard(group, tripIndex, tripContext);
                            // console.log(`âœ… Successfully rendered trip card ${tripIndex}`);
                        } catch (error) {
                            console.error(`âŒ Failed to render trip card ${tripIndex}:`, error);
                            
                            // Fallback: Create a basic card manually
                            const fallbackCard = document.createElement('div');
                            fallbackCard.className = 'card trip-card shadow-sm mb-4';
                            fallbackCard.innerHTML = `
                                <div class="card-body">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        This trip contains ${group.variations?.length || 0} travel options.
                                        <br>
                                        <small>Unable to render full trip details. Please try refreshing the page.</small>
                                    </div>
                                </div>
                            `;
                            tripResults.appendChild(fallbackCard);
                        }
                        
                        tripIndex++;
                    });
                } else {
                    // Handle trips with no results
                    const noResultsCard = document.createElement('div');
                    noResultsCard.className = 'card trip-card shadow-sm mb-4';
                    noResultsCard.innerHTML = `
                        <div class="saved-trip-header">
                            <div class="trip-header-main">
                                <div class="trip-info-section">
                                    <h5 class="trip-title">
                                        <i class="fas fa-bookmark me-2"></i>${savedTrip.trip_name}
                                    </h5>
                                    <div class="trip-meta-info">
                                        <div class="trip-meta-item">
                                            <i class="fas fa-calendar-plus"></i>
                                            <span>Saved ${new Date(savedTrip.created_at).toLocaleDateString()}</span>
                                        </div>
                                        <div class="trip-meta-item">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span>${startLocation}</span>
                                        </div>
                                        <div class="trip-meta-item">
                                            <i class="fas fa-calendar"></i>
                                            <span>${startDate}</span>
                                        </div>
                                        <div class="trip-meta-item">
                                            <i class="fas fa-clock"></i>
                                            <span>${tripDuration} days</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="trip-actions-header">
                                    <button class="btn btn-sm btn-favorite ${savedTrip.is_favorite ? 'favorited' : ''}" 
                                            onclick="toggleTripFavorite('${savedTrip.id}', ${savedTrip.is_favorite})">
                                        <i class="fas fa-heart me-1"></i>
                                        ${savedTrip.is_favorite ? 'Favorited' : 'Favorite'}
                                    </button>
                                    <button class="btn btn-sm btn-delete" 
                                            onclick="showDeleteConfirm('${savedTrip.id}', '${savedTrip.trip_name}')" 
                                            title="Delete this trip">
                                        <i class="fas fa-trash me-1"></i>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                This saved trip had no available options at the time of saving.
                            </div>
                        </div>
                    `;
                    tripResults.appendChild(noResultsCard);
                }
            });
    
            // Render TBD games if any exist
            const lastTrip = trips[trips.length - 1];
            if (lastTrip && lastTrip.tbd_games && lastTrip.tbd_games.length > 0) {
                try {
                    renderTbdGames(lastTrip.tbd_games, lastTrip.must_teams || []);
                } catch (error) {
                    console.error('âŒ Failed to render TBD games:', error);
                }
            }
        }

        // CORRECTED VERSION:
        function updateStatsCards() {
            const totalTrips = savedTrips.length;
            const favoriteTrips = savedTrips.filter(trip => trip.is_favorite).length;
            
            document.getElementById('totalTripsCount').textContent = totalTrips;
            document.getElementById('favoriteTripsCount').textContent = favoriteTrips;
            // âœ… Removed the searchHistory reference since we removed that functionality
        }
        
        function setupEventListeners() {
            // Trip search input
            const searchInput = document.getElementById('tripSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', filterTrips);
            }
    
            // Profile form
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', handleProfileUpdate);
            }
        }
    
        // Trip management functions
        async function toggleTripFavorite(tripId, currentState) {
            try {
                const response = await window.apiService.toggleTripFavorite(tripId, !currentState);
                if (response.success) {
                    // Update local state
                    const trip = savedTrips.find(t => t.id === tripId);
                    if (trip) {
                        trip.is_favorite = !currentState;
                    }
                    
                    // Reload display
                    displaySavedTrips(savedTrips);
                    updateStatsCards();
                }
            } catch (error) {
                console.error('âŒ Failed to toggle favorite:', error);
            }
        }
            
        function showDeleteConfirm(tripId, tripName) {
            // If you still show the trip name in the modal, set it here:
            const tripNameElem = document.getElementById('deleteConfirmTripName');
            if (tripNameElem) tripNameElem.textContent = tripName || '';
        
            document.getElementById('confirmDeleteBtn').onclick = () => deleteTripConfirmed(tripId);
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
            modal.show();
        }
            
        async function deleteTripConfirmed(tripId) {
            try {
                const response = await window.apiService.deleteSavedTrip(tripId);
                if (response.success) {
                    // Remove from local state
                    savedTrips = savedTrips.filter(trip => trip.id !== tripId);
                    
                    // Reload display
                    displaySavedTrips(savedTrips);
                    updateStatsCards();
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
                    modal.hide();
                                    }
            } catch (error) {
                console.error('âŒ Failed to delete trip:', error);
            }
        }
    
        async function handleProfileUpdate(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('fullName').value;
            
            try {
                const response = await window.authService.updateProfile({ full_name: fullName });
                if (response.success) {
                } else {
                }
            } catch (error) {
                console.error('âŒ Failed to update profile:', error);
            }
        }
    

        // Make functions globally available
        window.toggleTripFavorite = toggleTripFavorite;
        window.showDeleteConfirm = showDeleteConfirm;
        window.filterTrips = filterTrips;
    </script>
        <script>
    document.addEventListener('DOMContentLoaded', async () => {
        if (window.authService && typeof window.authService.getCurrentUser === 'function') {
            try {
                const user = await window.authService.getCurrentUser();
                const accountLink = document.getElementById('footer-account-link');
                if (accountLink) {
                    if (user) {
                        accountLink.innerHTML = '<a href="./profile.html" class="text-light">My Account</a>';
                    } else {
                        accountLink.innerHTML = '<a href="./login.html" class="text-light">Sign Up / Log In</a>';
                    }
                }
            } catch (e) {
                const accountLink = document.getElementById('footer-account-link');
                if (accountLink) {
                    accountLink.innerHTML = '<a href="./login.html" class="text-light">Sign Up / Log In</a>';
                }
            }
        }
    });
    </script>
    </body>
</html>